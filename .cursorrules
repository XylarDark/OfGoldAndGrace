# Cursor Rules: Of Gold And Grace Shopify Theme
# Curated from cursor.directory best practices
# Version: 2.5 - Post-Cycle Rules Closeout

project_goals:
  - Minimal cost: Shopify Online Store 2.0 theme only; no headless stack or paid services.
  - WCAG AA accessibility compliance with keyboard navigation and screen reader support.
  - Core Web Vitals optimization: LCP < 2.5s, CLS < 0.1, FID < 100ms.
  - SEO-first: Structured data, semantic HTML, performance-optimized assets.
  - Developer experience: Automated testing, linting, CI/CD, and comprehensive documentation.

languages:
  - liquid: Shopify templating with Online Store 2.0 sections/snippets
  - javascript: ES2020+ vanilla JS, modular assets/, no frameworks
  - css: Theme tokens, utility-first, responsive design
  - json: Configuration, locales, and structured data

guardrails:
  - No server-side code: Shopify Liquid only; no Node.js, PHP, or external runtimes.
  - Secrets management: API keys in theme settings only; never commit credentials.
  - External services: Free tier only; document all app installs in PR descriptions.
  - Performance budget: Bundle size < 100KB JS/CSS; defer non-critical assets.
  - CI Node version: Standardize on Node 20.x LTS for all GitHub Actions workflows.
  - Browser support: Chrome, Safari, Firefox, Edge (last 2 versions).
  - localStorage usage: Handle quota exceeded errors; no sensitive data storage; wishlist limited to product handles only.

code_style:
  liquid:
    - Sections/snippets architecture: Reusable, configurable components.
    - Conditional rendering: Use settings for feature toggles; avoid complex inline logic.
    - Data attributes: Use data-* for JavaScript hooks and state management.
    - Safe fallbacks: Defensive JSON-LD generation; handle missing metafields/settings.
    - Accessibility first: Alt text, ARIA labels, semantic HTML structure.
    - Performance: Lazy load images, optimize loops, cache expensive operations.
  javascript:
    - ES2020+ features: Async/await, optional chaining, nullish coalescing.
    - Modular architecture: One responsibility per file in assets/.
    - Client-side filtering: URL synchronization for bookmarkable states.
    - Progressive enhancement: Core functionality without JS; enhanced with JS.
    - State management: URL params for shareable states; localStorage for persistence.
    - Accessibility: Focus traps, keyboard navigation, ARIA live regions, announcements.
    - Error handling: Try/catch blocks, graceful degradation, user feedback.
    - No frameworks: Vanilla JS only; small utility functions.
  css:
    - Theme tokens: CSS custom properties for colors, spacing, typography.
    - Utility-first: Composable classes over monolithic components.
    - Responsive: Mobile-first with fluid typography and spacing.
    - Performance: Minimize specificity, avoid @import, optimize selectors.
    - Accessibility: Focus indicators, reduced motion, high contrast support.
    - No !important: Use specificity hierarchy instead.

files:
  - Core protection: layout/, config/, locales/ - never modify without review.
  - Theme configuration: config/settings_schema.json for all settings.
  - Component architecture: sections/ for pages, snippets/ for reusable parts.
  - Asset organization: assets/ for JS/CSS/images; __tests__/ for testing.
  - Documentation: README.md, .cursorrules, .github/ templates and guidelines.

patterns:
  - Quick View: data-quick-view="product-handle" on buttons.
  - Wishlist: data-wishlist-toggle with data-product-handle and data-product-title.
  - Collection Filters: data-tag-checkbox, data-price-min/max, data-availability-filter.
  - Product Media: Comprehensive snippet handling images/videos with responsive srcset/sizes (3D optional).
  - Responsive Images: srcset with multiple sizes + sizes attribute for performance.
  - Lazy Images: data-src + class="lazy" + width/height/aspect-ratio attributes.
  - Modals: data-focus-trap + aria-modal="true" + role="dialog".
  - Announcements: aria-live regions with priority-based messaging.
  - Skip Links: .skip-link elements with valid target IDs and navigation announcements.
  - 404 Pages: Friendly error templates with search, popular products, and multiple recovery options.
  - Form validation: Client-side with server confirmation; clear error messages.
  - Feature Toggles: Theme settings for conditional rendering and auto-hide.
  - State management: URL params for shareable states; data-* attributes for component state; localStorage for persistence.
  - Safe JSON-LD: Conditional fields based on available data; defensive generation with comprehensive testing.

development_environment:
  - PowerShell compatibility: Avoid bash-style command chaining (&&); run commands separately.
  - Error tracking: Document environment-specific errors and add to session reports for rule refinement.
  - Session reporting: At end of coding sessions, include encountered errors and workarounds in PR descriptions.
  - Platform testing: Test critical commands on target environment before implementation.
  - Command separation: Use individual terminal_cmd calls instead of chained commands in automation.
  - TODO management: Regularly reconcile and clean up legacy TODOs to maintain project clarity.
  - Session review: Update .cursorrules with new patterns and best practices after each phase.
  - CI artifact retention: Performance budget reports (7 days); Lighthouse reports (30 days); align with policies.

advanced_patterns:
  - Client-side filtering: URL synchronization for bookmarkable states; real-time DOM updates.
  - Merchant configuration: Theme settings for feature toggles and customization options.
  - Progressive enhancement: Core functionality works without JS; enhanced with JS features.
  - Defensive programming: Safe fallbacks for missing data in JSON-LD and templates.
  - Product media rendering: Comprehensive snippets handling multiple media types with responsive optimization.
  - Legacy TODO management: Regular cleanup of stale tasks to maintain project clarity and focus.
  - Resource hints optimization: Strategic preconnect hints for external domains used by theme features.
  - Skip-link validation: Ensure all skip-links have valid targets with proper ID containers.
  - Navigation announcements: Screen reader feedback for all navigation changes and user actions.
  - 404 page optimization: User-friendly error experiences with multiple recovery pathways.
  - JSON-LD testing: Comprehensive validation tests for structured data schema compliance.
  - Accessibility announcements: Comprehensive screen reader support for all user actions.
  - SEO optimization: robots.txt, structured data, and meta tag management.
  - Performance patterns: Responsive images, critical path optimization, and bundle management.
  - Testing strategies: Mock complex DOM interactions; test error states and edge cases.

accessibility:
  - WCAG AA compliance: 4.5:1 contrast ratio, 3:1 for large text.
  - Keyboard navigation: Tab order logical; Enter/Space activate controls.
  - Screen readers: ARIA labels, live regions, semantic HTML structure.
  - Focus management: Visible focus indicators, focus traps for modals.
  - Motion sensitivity: prefers-reduced-motion media query support.
  - Color independence: No color-only information conveyance.
  - Error identification: Clear labels, descriptions, and suggestions.

performance:
  - Core Web Vitals: LCP < 2.5s, CLS < 0.1, FID < 100ms targets.
  - Resource loading: Preconnect to external domains; preload critical fonts.
  - Script optimization: Defer non-critical JS; async third-party scripts.
  - Image optimization: Lazy loading, WebP format, proper dimensions.
  - Bundle size: < 100KB total JS/CSS; tree-shake unused code.
  - Critical path: Inline hero CSS; defer non-visible styles.
  - Caching strategy: Cache headers for static assets; version files.

testing:
  - Unit tests: assets/__tests__/test-runner.html for JS component testing.
  - Integration tests: Manual testing of Quick View, Wishlist, filters, cart flows.
  - DOM interaction testing: Mock complex UI behaviors and state changes.
  - URL synchronization: Test bookmarkable states and parameter handling.
  - Error state testing: Network failures, missing data, invalid configurations.
  - JSON-LD validation: Comprehensive schema testing with parsing, structure, and fallback validation.
  - Skip-link validation: Ensure all skip-links have valid targets and proper functionality.
  - Product media testing: Validate responsive images and video embedding (3D model rendering if enabled).
  - 404 page testing: Verify error page functionality, search integration, and localization.
  - Cross-browser: Chrome, Safari, Firefox, Edge compatibility.
  - Accessibility: Keyboard navigation, screen reader testing, announcement verification.
  - Performance: Lighthouse audits (85+ performance, 90+ accessibility).
  - Responsive: Mobile, tablet, desktop viewport testing.
  - Feature toggles: Test conditional rendering and auto-hide behaviors.

review:
  - Scope Gate compliance: Verify PR template Scope Gate checklist is completed for new features/settings/impacts.
  - Optional Feature Retention: Assess optional features for removal if unused beyond 2 release cycles.
  - Pre-commit checks: Shopify CLI theme check; lint JSON/CSS/JS.
  - Manual testing: Quick View, Wishlist, filters, cart flows, and 404 page functionality.
  - Feature toggle testing: Verify conditional rendering and auto-hide behaviors.
  - URL state testing: Confirm bookmarkable filter states and parameter handling.
  - Skip-link validation: Ensure all skip-links have valid targets and proper announcements.
  - Product media testing: Validate responsive images and video controls (3D model rendering if enabled).
  - JSON-LD validation: Comprehensive schema testing with parsing, structure, and fallback validation.
  - Accessibility audit: Keyboard navigation, screen reader compatibility, announcement verification.
  - Performance validation: Lighthouse scores meet targets; responsive image loading; resource hints.
  - Code review: Follow PR template; test all modified functionality.
  - Documentation: Update README for new features, settings, and merchant instructions.
  - TODO reconciliation: Clean up legacy and completed TODOs before session completion.
  - Error reporting: Include environment-specific errors encountered and workarounds implemented.
  - Session summary: Document problems faced and solutions found for future reference.
  - Rules update: Review session work and update .cursorrules with new patterns and best practices.

contribution:
  - Scope Gate: Complete PR template Scope Gate checklist for any new features/settings/external domains.
  - Branch naming: feat/, fix/, refactor/, perf/, docs/, test/ prefixes.
  - Commit messages: Conventional commits with scope (sections/product-card).
  - PR requirements: Description, testing notes, screenshots for UI changes.
  - Code ownership: Review required for layout/, config/, core functionality.
  - Breaking changes: Document in PR description and commit footer.

commits:
  - Format: type(scope): description
  - Types: feat, fix, refactor, perf, docs, test, chore
  - Scope: theme area (sections/product, snippets/card, assets/quick-view)
  - Breaking changes: Add "BREAKING CHANGE:" footer with migration notes
  - Examples: "feat(sections/product): add variant swatches, fix(snippets/card): resolve lazy loading CLS"

policies:
  - Scope Gate: Require explicit approval for new features, settings, external domains, or significant impacts.
  - Optional Feature Retention: Keep optional features only if actively used within 2 release cycles, or when user benefit outweighs maintenance cost.
  - CI Performance Budgets: JS+CSS bundles must stay under 100KB total (source sizes); 80KB triggers warnings. Test assets excluded. Report-only CI (no failures). Budgets defined in lighthouse-budgets.json and enforced by scripts/check-performance-budget.js.
  - Budget Governance: Request exceptions in PR description with mitigation plan; remediate within 2 weeks; document budget increases in PRs; Lighthouse budgets align with Core Web Vitals targets (LCP <2.5s, CLS <0.1, FID <100ms).

version_control:
  - Rules versioning: Update version number in header for major changes and phase completions.
  - Change documentation: Document rule modifications in commit messages.
  - Backwards compatibility: Avoid breaking changes; use deprecation warnings.
  - Migration guide: Update README when rules change significantly.
  - Error integration: Incorporate documented errors into rules for continuous improvement.
  - Environment updates: Add platform-specific workarounds and compatibility notes.
  - Pattern documentation: Update patterns section when new architectural patterns emerge.
  - Session-driven updates: Review each development session and update rules with new optimizations.
  - Advanced practices: Add advanced_patterns section for complex implementation strategies.
  - TODO maintenance: Document legacy cleanup patterns and project clarity practices.

cycle_closeout:
  - Session Review: After each Planâ†’Agent cycle, complete this checklist before marking PR ready:
    - [ ] Summarize changes: features added, tests written, CI/docs updated, bugs fixed
    - [ ] Log errors/workarounds: Any platform/environment errors encountered and solutions
    - [ ] Rules deltas: What to add/modify/remove in .cursorrules (policies, guardrails, patterns)
    - [ ] Version bump: Increment version in header if policies/guardrails changed
    - [ ] Changelog entry: Add dated entry to docs/rules-changelog.md with highlights/rationale
    - [ ] PR template: Fill Session Review section with changes, errors, version bump, changelog link
  - Governance reminders: Report-only CI will remind you if rules/changelog updates are missing
  - Changelog location: docs/rules-changelog.md (append-only log with date, version, highlights)